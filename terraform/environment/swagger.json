{
  "swagger": "2.0",
  "info": {
    "title": "kinesis-stream",
    "version": "0.0.1"
  },
  "basePath": "/kinesis",
  "schemes": ["https"],
  "x-amazon-apigateway-request-validators": {
    "Validate body": {
      "validateRequestParameters": false,
      "validateRequestBody": true
    }
  },
  "paths": {
    "/metrics": {
      "put": {
        "consumes": ["application/json"],
        "produces": ["application/json"],
        "parameters": [
          {
            "in": "body",
            "name": "PutMetrics",
            "required": true,
            "schema": {
              "$ref": "#/definitions/PutMetrics"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "200 response",
            "schema": {
              "$ref": "#/definitions/PutMetrics"
            }
          },
          "404": {
            "description": "Not found",
            "schema": {
              "$ref": "#/definitions/ErrorModel"
            }
          }
        },
        "x-amazon-apigateway-request-validator": "Validate body",
        "x-amazon-apigateway-integration": {
          "type": "aws",
          "credentials": "${allowed_roles}",
          "uri": "arn:aws:apigateway:${region}:kinesis:action/PutRecords",
          "responses": {
            "default": {
              "statusCode": "200"
            }
          },
          "requestTemplates": {
            "application/json": "{\n    \"StreamName\": \"${name}\",\n    \"Records\": [\n       #foreach($elem in $input.path('$.metrics'))\n          {\n            \"Data\": \"$util.base64Encode($util.escapeJavaScript($elem.metric))\",\n            \"PartitionKey\": \"default\"\n          }#if($foreach.hasNext),#end\n        #end\n    ]\n}"
          },
          "passthroughBehavior": "when_no_templates",
          "httpMethod": "POST"
        }
      }
    }
  },
  "definitions": {
    "ErrorModel": {
        "type": "object",
        "required": [
          "message",
          "code"
        ],
        "properties": {
          "message": {
            "type": "string",
            "maxLength": 200,
            "pattern": "^[0-9a-zA-Z]$"
          },
          "code": {
            "type": "integer",
            "minimum": 100,
            "maximum": 600,
            "pattern": "^[1-9]{3}$",
            "format": "-"
          }
        }
      },
    "PutMetrics": {
      "title": "The root schema",
      "description": "The root schema comprises the entire JSON document.",
      "required": ["metrics"],
      "properties": {
        "metrics": {
          "maxItems": 20,
          "type": "array",
          "title": "The metrics schema",
          "description": "An explanation about the purpose of this instance.",
          "default": [],
          "items": {
            "type": "object",
            "title": "The first anyOf schema",
            "description": "An explanation about the purpose of this instance.",
            "default": {},
            "required": ["metric"],
            "properties": {
              "metric": {
                "type": "object",
                "title": "The metric schema",
                "description": "An explanation about the purpose of this instance.",
                "default": {},
                "required": ["Dimensions", "Project", "Time"],
                "properties": {
                  "Dimensions": {
                    "type": "string",
                    "title": "The Dimensions schema",
                    "description": "An explanation about the purpose of this instance.",
                    "maxLength": 10,
                    "pattern": "^[a-zA-Z-_]{1,10}$"
                  },
                  "Project": {
                    "type": "string",
                    "title": "The Project schema",
                    "description": "An explanation about the purpose of this instance.",
                    "maxLength": 15,
                    "pattern": "^[a-zA-Z-_]{1,15}$"
                  },
                  "MeasureName": {
                    "type": "string",
                    "title": "The MeasureName schema",
                    "description": "An explanation about the purpose of this instance.",
                    "maxLength": 15,
                    "pattern": "^[a-zA-Z-_]{1,15}$"
                  },
                  "MeasureValue": {
                    "type": "string",
                    "title": "The MeasureValue schema",
                    "description": "An explanation about the purpose of this instance.",
                    "maxLength": 5,
                    "pattern": "^[0-9\\.]{1,5}$"
                  },
                  "MeasureValueType": {
                    "type": "string",
                    "title": "The MeasureValueType schema",
                    "description": "An explanation about the purpose of this instance.",
                    "maxLength": 8,
                    "pattern": "^[a-zA-Z-_]{1,8}$"
                  },
                  "Time": {
                    "type": "string",
                    "title": "The Time schema",
                    "description": "An explanation about the purpose of this instance.",
                    "maxLength": 13,
                    "pattern": "^[0-9]{13}$"
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
